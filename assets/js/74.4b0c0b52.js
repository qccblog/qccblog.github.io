(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{657:function(s,t,a){"use strict";a.r(t);var n=a(17),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("blockquote",[a("p",[s._v("Sentry – 正如其名「哨兵」，可以实时监控生产环境上的系统运行状态，一旦发生异常会第一时间把报错的路由路径、错误所在文件等详细信息以邮件形式通知我们，并且利用错误信息的堆栈跟踪快速定位到需要处理的问题。")])]),s._v(" "),a("h2",{attrs:{id:"使用-sentry"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-sentry"}},[s._v("#")]),s._v(" 使用 Sentry")]),s._v(" "),a("p",[s._v("Sentry 是一个功能强大的监控系统，支持多种语言，可以很方便和不同系统集成。依照一般习惯都是先上一波安装再上使用，不过由于官方有提供免费的服务，可以先尝尝鲜，感觉不合适还可以直接弃坑。")]),s._v(" "),a("h3",{attrs:{id:"注册使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册使用"}},[s._v("#")]),s._v(" 注册使用")]),s._v(" "),a("p",[s._v("直接访问 "),a("a",{attrs:{href:"https://sentry.io/signup/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://sentry.io/signup/"),a("OutboundLink")],1),s._v(" 输入基本信息注册之后即可使用。")]),s._v(" "),a("p",[s._v("初次注册使用会有引导，如果以前使用过可以直接跳过。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/03/29/Cm2Mu6poR79nGK8.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("这边选择一个 JavaScript 的项目进行创建。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/03/29/4meYEkNs3ona5wq.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("创建后就进入安装向导了，和使用其他库类似，现在我们需要监控工程上先引入 cdn 上的 js 文件，再初始化 Sentry（这个操作要尽可能往前放，因为如果放到后面在此之前的就监听不到了）。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/03/29/g3MPY7FdwORuUZJ.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("实际上上述操作之后已经完成了安装了，不过可以看到页面上那个\n"),a("strong",[s._v("Waiting for verification event")]),s._v(" 的红点还一直在动，这个时候我们可以来验证一下是不是配置成功了。很简单，随便在工程里面搞点东西报错就行了，或者直接执行一下页面上给出的那个没有定义的函数也一样。可以看到报错后会发送一个请求到 sentry.io 上，里面包含了具体的报错信息，这时候页面上的验证小红点也变绿了，同时邮箱也会收到报错的邮件。到这里基本上算是可以正常使用了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/01/fXVNe3IzkOvJS98.png",alt:"a.png"}})]),s._v(" "),a("p",[s._v("点击页面上新出来的 "),a("strong",[s._v("Take me to my event")]),s._v(" 就可以看到具体的报错详情了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/03/29/t43mWG7vpDnSfCU.png",alt:"image.png"}})]),s._v(" "),a("h3",{attrs:{id:"基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本使用"}},[s._v("#")]),s._v(" 基本使用")]),s._v(" "),a("h4",{attrs:{id:"project"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#project"}},[s._v("#")]),s._v(" Project")]),s._v(" "),a("p",[s._v("Project 可以针对不同情况创建多个，比如前后端分离的项目可以分别创建不同的 Project。")]),s._v(" "),a("p",[s._v("配置三部曲：选项目类型、选报警类型、设置项目名称和 Team 即可创建一个项目，然后根据创建后的提示在工程中进行配置就 OK 了。")]),s._v(" "),a("h5",{attrs:{id:"dsn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dsn"}},[s._v("#")]),s._v(" DSN")]),s._v(" "),a("p",[s._v("DSN 是客户端往 Sentry 服务器发送报错信息的时候的通信凭证，服务器根据这个公钥判断发送报错信息的客户端是否认证合法。我们在服务端创建一个新的项目，都会得到一个唯一的 DSN，在客户端初始化时会用到这个密钥，后续对错误的上报都是要带上这个 DSN。")]),s._v(" "),a("h4",{attrs:{id:"issues"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#issues"}},[s._v("#")]),s._v(" Issues")]),s._v(" "),a("p",[s._v("issue 可以大概等于我们常说的报错，Sentry 会根据堆栈跟踪和其他因素将类似报错自动归为同一个 issue。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/03/29/Dw6NKTjz2ZXh4Y3.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("可以看到不同类型的报错或者同类型但是原因不一样的报错是被分开的，如果是同一个报错只会增加 EVENTS。")]),s._v(" "),a("p",[s._v("点击进入一个 issue 第一次进入会有新手引导，跟着新手引导来看看有哪些东西吧。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/03/29/9vMSCGofs6OcQqX.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("对 issue 可执行的动作：可以把一个 issue 标记为已经解决了（什么版本）；忽略某个 issue（根据什么一定的条件）；删除掉某个 issue 设置以后都不接收相同的；还有就是分享，标记之类的。")]),s._v(" "),a("p",[s._v("通过制定 Ownership Rules 来定义相关责任人来负责具体的报错，比如 "),a("code",[s._v("path:/demo.html")]),s._v(" 匹配到的报错发送个 A，"),a("code",[s._v("url:http://localhost:3000/demo.html")]),s._v(" 发送给 B。这样就能比较准确的把错误推给真正想要的人，不然就是消息轰炸了。")]),s._v(" "),a("p",[s._v("根据 tag 可以来筛选同类型的报错，对报错进行分类。")]),s._v(" "),a("h4",{attrs:{id:"主动报错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主动报错"}},[s._v("#")]),s._v(" 主动报错")]),s._v(" "),a("p",[s._v("之前使用过程中的上报错误都是 Sentry 捕获到错误后自动进行上报的，实际上也是可以通过 captureException 手动上报错误信息的。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 发送异常")]),s._v("\nSentry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("captureException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Something broke"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 发送消息，可以定义level")]),s._v("\nSentry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("captureMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'this is a debug message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'debug'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("在 Sentry 控制面板可以发现有很多可配置属性，从创建到使用上来看基本上没有什么复杂的操作，使用起来还是比较方便的，"),a("a",{attrs:{href:"https://docs.sentry.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),a("OutboundLink")],1),s._v(" 也很详细。")]),s._v(" "),a("h2",{attrs:{id:"安装-sentry"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-sentry"}},[s._v("#")]),s._v(" 安装 Sentry")]),s._v(" "),a("p",[s._v("如果使用了官方提供的服务感觉还不错值得深入使用，那么就可以考虑自行部署一个了，毕竟使用官方提供的服务有一些限制，还有些功能也无法使用。好在其不仅开源更是提供了多种部署方式，直接安装 Sentry 还是比较麻烦的，建议使用官方给出的库基于 docker 进行安装，基本上算是一键安装了，更多细节可以参考官网安装文档 "),a("a",{attrs:{href:"https://docs.sentry.io/server/installation/",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker install sentry"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"安装前准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装前准备"}},[s._v("#")]),s._v(" 安装前准备")]),s._v(" "),a("ul",[a("li",[s._v("Docker 17.05.0+")]),s._v(" "),a("li",[s._v("Docker Compose 1.19.0+")]),s._v(" "),a("li",[s._v("A dedicated (sub)domain to host Sentry on (for example, sentry.yourcompany.com).")]),s._v(" "),a("li",[s._v("At least 2400MB memory")]),s._v(" "),a("li",[s._v("2 CPU Cores")])]),s._v(" "),a("p",[s._v("可以看到对运行环境还是有一定要求的，内存和 cpu 要满足需求。")]),s._v(" "),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[s._v("第一次安装的话先不修改配置，直接全部使用默认的配置进行安装部署即可。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取官方仓库并安装")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/getsentry/onpremise.git\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" onpremise\n./install.sh\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果一切顺利可以直接安装成功")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装成功知乎执行即可")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up -d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("安装过程中会询问是否要创建账号，这边可以直接创建一个账号，工程启动之后可以用来直接登录。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("Would you like to create a user account now? "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Y/n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\nEmail: abc@abc.com\nPassword:\nRepeat "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" confirmation:\nUser created: abc@abc.com\nAdded to organization: sentry\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("开始安装过程中碰到过说有几个镜像需要登录认证，在 issue 上并没有看到类似的问题，可能是个例，重新多试几次也解决了。(后续重新安装没有碰到这种问题，猜测是当时某个源不稳导致)")]),s._v(" "),a("p",[s._v("运行成功之后访问 "),a("a",{attrs:{href:"http://localhost:9000",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://localhost:9000"),a("OutboundLink")],1),s._v("（Sentry 默认启动端口就是 9000），输入前面创建的账号密码即可登录使用，可以在页面底部看到安装的版本为 Sentry 10.1.0.dev0。使用上和官方提供的服务类似，但是配置项和提供的服务要多一些。")]),s._v(" "),a("p",[s._v("当前版本在创建完成之后会默认创建一个名为 internal 的项目，这个项目就是对 Sentry 服务自身的一个 Project，碰到 Sentry 发生了什么报错就会发送到这里面。")]),s._v(" "),a("h3",{attrs:{id:"配置和使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置和使用"}},[s._v("#")]),s._v(" 配置和使用")]),s._v(" "),a("p",[s._v("刚刚是直接使用默认配置进行启动的，实际使用过程往往都是要经过一些配置才符合我们的需求。可以进入 sentry 目录修改配置文件然后重新安装启动。"),a("a",{attrs:{href:"https://docs.sentry.io/server/config/",target:"_blank",rel:"noopener noreferrer"}},[s._v("服务器完整的配置列表"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h4",{attrs:{id:"配置邮件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置邮件"}},[s._v("#")]),s._v(" 配置邮件")]),s._v(" "),a("p",[s._v("使用官网的服务时候在有报错的时候会发送邮件到邮箱，配置个邮箱服务器发送报错信息可以及时获取到出错信息。")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mail.backend: 'smtp'  # Use dummy if you want to disable email entirely")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'smtp.163.com'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("465")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'your@163.com'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'your smpt sceret'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.use-tls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The email address to send on behalf of")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.from")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'your@163.com'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("配置完成之后，执行 install 后重启启动发现 issue 中多了一条邮箱的报错，邮箱配置没有成功，测试发送邮件也不成功。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/03/31/CkoKZJdBHNSPxbj.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("根据大家的踩坑记录来看，直接上默认的配置出来的邮箱基本上无法使用，看到有使用 django 进行配置是可以使用的，也照着来配置一下。")]),s._v(" "),a("p",[s._v("安装 django_smtp_ssl 依赖")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" onpremise/sentry\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑依赖文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" requirements.txt\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加如下内容")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Add plugins here")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发邮件支持SSL协议")]),s._v("\ndjango-smtp-ssl~"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("\nredis-py-cluster"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".4\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("修改 config.yml 进行配置")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mail.backend: 'smtp'  # Use dummy if you want to disable email entirely")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.backend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'django_smtp_ssl.SSLEmailBackend'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'smtp.163.com'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("587")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'your@163.com'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'your smpt sceret'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.use-tls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The email address to send on behalf of")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mail.from")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'your@163.com'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("重新安装启动")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/onpremise\n./install.sh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up -d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("进入工程一看发现没有新的 issue 基本上稳了，试了一下测试发送邮件也 ok，邮箱服务器就算是配置成功了。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/03/31/RHGI2l5pAKrak1W.png",alt:"image.png"}})]),s._v(" "),a("h4",{attrs:{id:"集成-github"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集成-github"}},[s._v("#")]),s._v(" 集成 GitHub")]),s._v(" "),a("p",[s._v("在设置面板的 Integrations 中可以看到可以和许多现在主流系统进行集成。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/03/31/kISaWnUyR6xqshF.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("GitHub 作为全球最大的程序员交友网站，妥妥的得先安排上。")]),s._v(" "),a("h5",{attrs:{id:"创建-github-app"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-github-app"}},[s._v("#")]),s._v(" 创建 GitHub App")]),s._v(" "),a("p",[s._v("首先根据 "),a("a",{attrs:{href:"https://developer.github.com/apps/building-github-apps/creating-a-github-app/",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub 官方文档"),a("OutboundLink")],1),s._v(" 创建一个 GitHub App，根据文档走下来整个流程基本上无阻碍可以走通。")]),s._v(" "),a("p",[s._v("创建 App 的时候发现要填写 "),a("code",[s._v("Homepage URL")]),s._v(" 和 "),a("code",[s._v("User authorization callback URL")]),s._v(" 之类的值，这些由 Sentry 服务器提供，需要的 value 值都可以根据 "),a("a",{attrs:{href:"https://docs.sentry.io/server/integrations/github/",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档"),a("OutboundLink")],1),s._v(" 配置进去，${urlPrefix}就是配置里面的 Root URL。强烈建议配置 Webhook secret。")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("配置项")]),s._v(" "),a("th",[s._v("对应值")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("Homepage URL")]),s._v(" "),a("td",[s._v("${urlPrefix}")])]),s._v(" "),a("tr",[a("td",[s._v("User authorization callback URL")]),s._v(" "),a("td",[s._v("${urlPrefix}/auth/sso/")])]),s._v(" "),a("tr",[a("td",[s._v("Setup URL (optional)")]),s._v(" "),a("td",[s._v("${urlPrefix}/extensions/github/setup/")])]),s._v(" "),a("tr",[a("td",[s._v("Webhook URL")]),s._v(" "),a("td",[s._v("${urlPrefix}/extensions/github/webhook/")])])])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("权限类型")]),s._v(" "),a("th",[s._v("权限")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("Repository administration")]),s._v(" "),a("td",[s._v("Read-only")])]),s._v(" "),a("tr",[a("td",[s._v("Repository contents")]),s._v(" "),a("td",[s._v("Read-only")])]),s._v(" "),a("tr",[a("td",[s._v("Issues")]),s._v(" "),a("td",[s._v("Read & write")])]),s._v(" "),a("tr",[a("td",[s._v("Pull requests")]),s._v(" "),a("td",[s._v("Read & write")])]),s._v(" "),a("tr",[a("td",[s._v("Repository webhooks")]),s._v(" "),a("td",[s._v("Read & write")])])])]),s._v(" "),a("p",[s._v("这些都配置完成后就可以点击创建 App 了，创建完成之后会提示生成私钥，根据提示生成后获取到下载的的私钥文件，后面要用到。")]),s._v(" "),a("h5",{attrs:{id:"配置-sentry"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-sentry"}},[s._v("#")]),s._v(" 配置 Sentry")]),s._v(" "),a("p",[s._v("首先配置 config.yml 文件，对应配置都在 GitHub App 中有，注意私钥的格式。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" sentry/config.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("github-app.id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40849")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("github-app.name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"steve-s-github-app"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("github-app.webhook-secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'secret'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("github-app.client-id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Iv1.864040de6e309766'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("github-app.client-secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'d9c746d43fd66f285270c3a3097f9dc73212679e'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("github-app.private-key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v("\n  -----BEGIN RSA PRIVATE KEY-----\n  MIIEpQIBAAKCAQEAqu1XfJ6Rt+t+c/i/cP1oK0tIJNtyBO4CtMqZFHOr3euXx6J7\n  FoQCAvcLurDrrF4YdzNLpipRF657sZsxq1VgCpSFrSDRtsXYZQvlcgfocOrMjAiO\n  3lIeLxVBNLfIw5Vl0RN++jj4WkBIPJVKHAYQ4dsb3Hh69Jmy3Qmoiu7Cl6eru4vX\n  e+cnv759pq6klek68EuDhBOwgcdPTbN7zHIdKIMB4tdTSLDjXad3yD1TgIzmi0jn\n  C/lzgHhtITdOaLW3SzVGFjzaQUu2Z7iBIrGqRduVKaYh/XYj0mYaWqaI29mce+wx\n  iLN42Rz3XGFwXccF1lM8g4ZdthLqBW8lY5LjTQIDAQABAoIBAQCfv7ELjJv+O/90\n  XiB2drAb/oEPyXUX/GbVF6DYh38yqtSxRT8q/PdwU/pHYsDw2QSeq3dhdp1Rt8Zt\n  aPGUAvf/C26gL1MxMlmbnvGzkIaCuj+wBPOZ/z+sm33Uyou9l+yP6lu7evFKUFfz\n  H0gjRtwSapjwhj3MS7XqdfNq3dlKqGhIooTQ3h4HhREUgmXUm85zVbZotufrOKiL\n  87OfAZiU7xqSAqGDU2v7zCpD90dmBmvocKm7Cxwmyx9xab1gKo+bOBiOzGv2Wpjx\n  LJnH6X86zVVGJY1TsHIwyc0aF8R1FOR3aOrMVyPvKKbiP4tMh07mV7kzFS/kayZr\n  z+mIZ8yVAoGBANjup/aAwfwtVe7D98PFFl3V8ujBclT5xQdqQlocdsJ5uaIPM6mk\n  y023vQqfW20qQjuhnP9qo/o+2QFKTTDhMB04I+bUUB3HhG1enWedcrpJ5J3hOFsz\n  GCRZ3SbaRLaBygAEwdeBdbF5c8DwMRAXQnTX3pMA/3PQGfyqFAL1glUvAoGBAMm1\n  r67c3WVK6tKyKs3g1kLqX3OgKAGxH+kRuILjPRZai6Lv1WJfBL7sljAWg+vwx7gh\n  BuNdOIm6bkPPWl2eW+ugUxAG19TNLKEPvIrWeDRlybOOULslNLV74xD7+sK82/me\n  ERxUPsBhTRQ41EYYOQ++YHf2Ybyl9WeNwnjF/OhDAoGAAgkjTF3i9CHcx5PRNGYa\n  EqFaWTLPhtqdLbeijcPsnWCVDF9GJdZlDgKmZH4gVoLqAjM/DOqMRWHnmWqAFPBY\n  Cj4noBfn9I+Vv4z+vyUsGXFuEsk1RS3SkSzCtYWg1XGcWqmww/v0BclU+7+FRlhh\n  iEUqUojU3NpcFBHohCqXoYMCgYEAlEUXZOQ5YfHV9xa8XCW/meSKUYYSolu+5yX9\n  iUjcaIgaSKUfJ3ZNGML0C1khk9ekF3c/hvXJT4RY9UOAW3zCeMubAxbkpCpFegcF\n  QtEv/uQrhe9A7LAGtLjiSmPPCkKlODG2xiovDl73t7umXfgEScxZQRU89tzPLVWI\n  9BolM90CgYEAzuovNmzH1ccepl+s21vg4W5RL1zk7StIY95/vgyXiX/nhmevJY/9\n  ZT+z2gjBot2F6uXcw8sPOV6a4w+ApQVOnwjiAk7PEH4mz6mgUE7c3s1T5l56/t4V\n  u8dDj9f+ACyDdS9yW+bGSPxiCaMcUeQG7XHVTtwAZZ91PEVGjKHUsdc=\n  -----END RSA PRIVATE KEY-----")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br")])]),a("p",[s._v("重启一下 Sentry")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" build\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" run --rm web upgrade\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up -d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("启动完成之后可以进入系统有没有相关的 issue，没有就证明基本上配置成功，如果有碰到报错也别慌，有了对应的 issue 排查起来还是很简单，各种报错也不用到处去找，基本上都能根据对应的报错进行解决，也可以到 "),a("a",{attrs:{href:"https://forum.sentry.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("论坛"),a("OutboundLink")],1),s._v(" 查找或求助错误的解决方案。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/01/pW5MXGxvZcokIKC.png",alt:"image.png"}})]),s._v(" "),a("h5",{attrs:{id:"安装-app"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-app"}},[s._v("#")]),s._v(" 安装 App")]),s._v(" "),a("p",[s._v("进入 GitHub Apps 选中创建的 App，选择安装 App，再选择一个账号进行安装，这个过程就会调用我们之前配置那些 url，如果配置一切 ok 那就能成功安装，如果配置有问题就需要在这边先卸载（GitHub 这边会显示已安装，实际上没有），再次进行安装。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/03/31/QBoLWe38GcVF9sb.png",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/03/31/WBp7I2M4ADnJ6yh.png",alt:"image.png"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/03/31/jDEpconWAs56amz.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("安装完成之后就可以到 Sentry 中配置 git 仓库了")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://i.loli.net/2020/04/01/oKjuXW5LmhC7Dvt.png",alt:"image.png"}})]),s._v(" "),a("h4",{attrs:{id:"切换语言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#切换语言"}},[s._v("#")]),s._v(" 切换语言")]),s._v(" "),a("p",[s._v("目前对中文的支持还不是很完善，不过可以切换过去体验一下。左侧点击组织右侧下拉图标-》选择用户设置-》PREFERENCES-》Language 选择简体中文，再刷新一下页面即可。")]),s._v(" "),a("p",[s._v("Sentry 还有很多强大的功能可以去发现和使用，实际使用下最大的感受就是方便详细，系统碰到了什么错误有了 issue 可以很方便的就定位到问题是什么，解决起来也很方便。")]),s._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/post/5e0ef88d5188253abd7d2c89#heading-11",target:"_blank",rel:"noopener noreferrer"}},[s._v("前端监控基础篇 — Docker + Sentry 搭建前端监控系统"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);