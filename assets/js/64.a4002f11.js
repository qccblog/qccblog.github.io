(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{647:function(s,n,t){"use strict";t.r(n);var a=t(17),e=Object(a.a)({},(function(){var s=this,n=s.$createElement,t=s._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://jenkins.io/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),t("OutboundLink")],1),s._v("下载地址。\n简便安装：")]),s._v(" "),t("ol",[t("li",[s._v("下载"),t("a",{attrs:{href:"http://mirrors.jenkins.io/war/latest/jenkins.war",target:"_blank",rel:"noopener noreferrer"}},[s._v("jenkins.war"),t("OutboundLink")],1),s._v("，"),t("a",{attrs:{href:"https://jenkins.io/doc/book/installing/#war-file",target:"_blank",rel:"noopener noreferrer"}},[s._v("安装说明"),t("OutboundLink")],1),s._v("。对于有tomcat的小伙伴，直接扔tomcat的webapps里面启动tomcat，访问tomcat工程地址/jenkins")]),s._v(" "),t("li",[s._v("docker安装\n"),t("ol",[t("li",[s._v("官方镜像"),t("a",{attrs:{href:"https://hub.docker.com/r/jenkins/jenkins/",target:"_blank",rel:"noopener noreferrer"}},[s._v("jenkins/jenkins"),t("OutboundLink")],1),s._v("，通过"),t("code",[s._v("sudo docker run -p 8080:8080 -p 50000:50000 -v /opt/data/jenkins:/var/jenkins_home --name jenkins jenkins/jenkins")]),s._v(" 运行。"),t("code",[s._v("/opt/data/jenkins")]),s._v("是定义在宿主上存放数据的地址，Jenkins是以文件夹的形式存放数据的。8080为访问Jenkins Server页面端口，50000为创建的Jenkins Slave与Master建立连接进行通信的默认端口。")]),s._v(" "),t("li",[s._v("官方推荐安装的镜像是"),t("a",{attrs:{href:"https://hub.docker.com/r/jenkinsci/blueocean/",target:"_blank",rel:"noopener noreferrer"}},[s._v("jenkinsci/blueocean"),t("OutboundLink")],1),s._v("，里面包含Blue Ocean插件。查看"),t("a",{attrs:{href:"https://jenkins.io/doc/book/installing/#downloading-and-running-jenkins-in-docker",target:"_blank",rel:"noopener noreferrer"}},[s._v("安装运行说明"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("个人推荐使用"),t("a",{attrs:{href:"https://hub.docker.com/r/frankqcc/jenkins",target:"_blank",rel:"noopener noreferrer"}},[s._v("frankqcc/jenkins:docker"),t("OutboundLink")],1),s._v("，支持支持docker功能，内置allure。直接通过"),t("code",[s._v("sudo docker run -p 50000:50000 -p 8060:8080 --name jenkins -d -v /var/run/docker.sock:/var/run/docker.sock --restart=always -v /opt/data/jenkins:/var/jenkins_home frankqcc/jenkins:docker")]),s._v("即可使用。")])])])]),s._v(" "),t("h2",{attrs:{id:"新增节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新增节点"}},[s._v("#")]),s._v(" 新增节点")]),s._v(" "),t("p",[s._v("可以通过配置Slave节点来提高Jenkins执行的效率。")]),s._v(" "),t("h3",{attrs:{id:"jnlp-slave"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jnlp-slave"}},[s._v("#")]),s._v(" "),t("a",{attrs:{href:"https://hub.docker.com/r/jenkins/jnlp-slave",target:"_blank",rel:"noopener noreferrer"}},[s._v("jnlp-slave"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker 运行jenkins-slave示例，使用jnlp方式进行连接，即是agent主动连接master")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run jenkins/jnlp-slave -url http://jenkins-server:port -workDir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/jenkins/agent "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("secret"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("agent name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("首先在Jenkins中新增一个系统管理-》节点管理-》新建节点。\n"),t("img",{attrs:{src:"https://i.loli.net/2020/03/18/iJMfRPXxqehO482.png",alt:"新建节点.png"}}),s._v(" "),t("img",{attrs:{src:"https://i.loli.net/2020/03/18/Nh6nqpsy4eaRoFz.png",alt:"配置节点.png"}}),s._v("\n保存之后会看到新建的这个节点有个红色的x，这是因为还没有这个节点，无法建立连接，接下来就是新建这个节点。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --name jenkins-slave02 -d --restart"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unless-stopped jenkins/jnlp-slave -url  http://192.168.1.232:8060 -workDir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/jenkins/agent02 secret agent02\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("其中url参数就是现有Jenkins服务器的地址，workDir就是刚刚配置时候设置的，secret就是下图的-secret后面的值。这些配置信息都可以点这个节点然后查看。\n"),t("img",{attrs:{src:"https://i.loli.net/2020/03/18/8ymLazUHRsBStkr.png",alt:"节点信息.png"}})]),s._v(" "),t("p",[s._v("使用以下镜像直接支持在slave中执行docker。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --name jenkins-slave02 -d -v /opt/slave/agent02:/home/jenkins/agent -v /var/run/docker.sock:/var/run/docker.sock --restart"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unless-stopped frankqcc/jnlp-slave -url http://192.168.1.232:8060 -workDir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/home/jenkins/agent secret agent02\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("需要注意的是这种方式运行的节点上执行docker都是宿主机上的行为。比如"),t("code",[s._v("-v /home/abc:/home")]),s._v("中的"),t("code",[s._v("/home/abc")]),s._v("就是运行docker宿主机上的路径。")]),s._v(" "),t("h2",{attrs:{id:"配置代理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置代理"}},[s._v("#")]),s._v(" 配置代理")]),s._v(" "),t("p",[s._v("简单贴了一下官网给出的通过nginx转发到Jenkins。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("upstream jenkins "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  keepalive "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# keepalive connections")]),s._v("\n  server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8080"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# jenkins ip and port")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n \nserver "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  listen          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Listen on port 80 for IPv4 requests")]),s._v("\n\n  server_name     jenkins.example.com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#this is the jenkins web root directory (mentioned in the /etc/default/jenkins file)")]),s._v("\n  root            /var/run/jenkins/war/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  access_log      /var/log/nginx/jenkins/access.log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  error_log       /var/log/nginx/jenkins/error.log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  ignore_invalid_headers off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pass through headers from Jenkins which are considered invalid by Nginx server.")]),s._v("\n\n  location ~ "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^/static/[0-9a-fA-F]{8}\\/(.*)$"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#rewrite all static files into requests to the root")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#E.g /static/12345678/css/something.css will become /css/something.css")]),s._v("\n    rewrite "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^/static/[0-9a-fA-F]{8}\\/(.*)"')]),s._v(" /"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" last"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  location /userContent "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#have nginx handle all the static requests to the userContent folder files")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#note : This is the $JENKINS_HOME dir")]),s._v("\n\troot /var/lib/jenkins/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("-f "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_filename")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#this file does not exist, might be a directory or a /**view** url")]),s._v("\n      rewrite "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" /"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" last"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tsendfile on"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  location / "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      sendfile off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_pass         http://jenkins"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_redirect     default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_http_version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      proxy_set_header   Host              "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_set_header   X-Real-IP         "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_set_header   X-Forwarded-For   "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_set_header   X-Forwarded-Proto "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_max_temp_file_size "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#this is the maximum upload size")]),s._v("\n      client_max_body_size       10m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      client_body_buffer_size    128k"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      proxy_connect_timeout      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_send_timeout         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_read_timeout         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_buffering            off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_request_buffering    off"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Required for HTTP CLI commands in Jenkins > 2.54")]),s._v("\n      proxy_set_header Connection "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Clear for keepalive")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br")])]),t("h2",{attrs:{id:"遇到的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[s._v("#")]),s._v(" 遇到的问题")]),s._v(" "),t("h3",{attrs:{id:"jenkenis报错-该jenkins实例似乎已离线"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jenkenis报错-该jenkins实例似乎已离线"}},[s._v("#")]),s._v(" Jenkenis报错：该jenkins实例似乎已离线")]),s._v(" "),t("p",[s._v("验证密钥之后，过了好久提示可能是离线。可以新开一个http://localhost:8080/pluginManager/advanced页面，把最下面的【升级站点】中的链接改成http形式的"),t("code",[s._v("http://updates.jenkins.io/update-center.json")]),s._v("，建议改成"),t("code",[s._v("https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json")]),s._v("的地址。重新访问即可，还有问题就需要重启一下看看。或者直接修改"),t("code",[s._v("/opt/data/jenkins/hudson.model.UpdateCenter.xml")]),s._v("里面对应的内容。")]),s._v(" "),t("h3",{attrs:{id:"下载插件速度慢"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载插件速度慢"}},[s._v("#")]),s._v(" 下载插件速度慢")]),s._v(" "),t("p",[s._v("由于update-center.json中很多地址并没有替换为镜像地址，所以下载插件时还是会直接访问\nhttp://updates.jenkins-ci.org。")]),s._v(" "),t("h4",{attrs:{id:"配置nginx代理update-jenkins-ci-org"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置nginx代理update-jenkins-ci-org"}},[s._v("#")]),s._v(" 配置Nginx代理update.jenkins-ci.org")]),s._v(" "),t("p",[s._v("推荐的方案。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一步：将updates.jenkins.org映射到本地nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/hosts\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 updates.jenkins-ci.org\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第二步：将请求映射到镜像网站")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/nginx/conf.d/default.conf\n\nlocation /download/plugins\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    proxy_next_upstream http_502 http_504 error "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" invalid_header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header Host mirrors.tuna.tsinghua.edu.cn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header X-Real-IP "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header X-Forwarded-For "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    rewrite /download/plugins"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" /jenkins/plugins/"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("break")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_pass https://mirrors.tuna.tsinghua.edu.cn"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h4",{attrs:{id:"直接修改文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#直接修改文件"}},[s._v("#")]),s._v(" 直接修改文件")]),s._v(" "),t("p",[s._v("这种方式适合不怎么使用插件的临时使用方案。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入更新配置位置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/data/jenkins/updates\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 替换所有插件下载的url和连接测试url")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/http:\\/\\/updates.jenkins-ci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g'")]),s._v(" default.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g'")]),s._v(" default.json\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"permission-denied报错"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#permission-denied报错"}},[s._v("#")]),s._v(" Permission denied报错")]),s._v(" "),t("p",[s._v("需要给我们挂载的目录对应的权限"),t("code",[s._v("sudo chown -R 1000 /opt/data/jenkins")])]),s._v(" "),t("h3",{attrs:{id:"jenkins-密码正确却突然登不上去-一直显示密码错误"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-密码正确却突然登不上去-一直显示密码错误"}},[s._v("#")]),s._v(" Jenkins/密码正确却突然登不上去（一直显示密码错误）")]),s._v(" "),t("ol",[t("li",[s._v("修改工作目录（JENKINS_HOME指向的目录）下的config.xml的true为false")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("useSecurity"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("true"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/useSecurity"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("重启Tomcat（重启Jenkins）")]),s._v(" "),t("li",[s._v('进入首页> "系统管理" > "全局安全配置"')]),s._v(" "),t("li",[s._v("在安全域中选择“jenkins专有用户数据库”，并保存")]),s._v(" "),t("li",[s._v("进入“系统管理”>“管理用户”")]),s._v(" "),t("li",[s._v("从用户列表选择要登录的那个账号（以admin为例），进入设置，拉到下面，修改密码并保存")]),s._v(" "),t("li",[s._v("即可重新登录了。（但此时是跳过验证状态，把第一步改的false改为true，并重启Tomcat生效）")])])])}),[],!1,null,null,null);n.default=e.exports}}]);