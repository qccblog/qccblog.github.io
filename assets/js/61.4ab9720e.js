(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{644:function(s,t,n){"use strict";n.r(t);var a=n(17),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("使用docker的过程中，如果碰到某些镜像不方便上传到公网的情况下，可以自己搭建一个私有的仓库。如果只是简单使用的情况下，使用"),n("code",[s._v("registry")]),s._v("基本上就可以满足需求了。")]),s._v(" "),n("h2",{attrs:{id:"安装配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装配置"}},[s._v("#")]),s._v(" 安装配置")]),s._v(" "),n("h3",{attrs:{id:"安装启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装启动"}},[s._v("#")]),s._v(" 安装启动")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载registry镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull registry\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是不是已经下载了镜像")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /opt/data/registry\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 -v /opt/data/registry:/var/lib/registry --name private_registry registry\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是否成功启动该容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前ip")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" addr show\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("其中run的参数中-d : 让容器可以后台运行；-p ：指定映射端口（前者是宿主机的端口号，后者是容器的端口号）；\n-v ：数据挂载（前者是宿主机的目录，后者是容器的目录）；--name : 为运行的容器命名。本机可以直接使用localhost，局域网内其他机器需要通过查出来的ip访问，本文以"),n("code",[s._v("192.168.1.178")]),s._v("为例。")]),s._v(" "),n("h3",{attrs:{id:"查看镜像仓库中所有的镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看镜像仓库中所有的镜像"}},[s._v("#")]),s._v(" 查看镜像仓库中所有的镜像")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.1.178:5000/v2/_catalog\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("当前还没有镜像所以返回的是"),n("code",[s._v('{"repositories":[]}')]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"配置私有仓库可信任"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置私有仓库可信任"}},[s._v("#")]),s._v(" 配置私有仓库可信任")]),s._v(" "),n("p",[s._v("默认情况下，docker的镜像源要是https的才行，如果只是简单的测试使用可以在配置文件中加入"),n("code",[s._v("insecure-registries")]),s._v("，但是在实际的使用中建议还是使用https进行操作。")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改或者新建配置文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/docker/daemon.json\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件中加入")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.1.178:5000"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"测试一下私有库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试一下私有库"}},[s._v("#")]),s._v(" 测试一下私有库")]),s._v(" "),n("p",[s._v("仓库已经创建和配置成功了，可以试试操作和使用。")]),s._v(" "),n("h3",{attrs:{id:"拉取一个镜像并打tag"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#拉取一个镜像并打tag"}},[s._v("#")]),s._v(" 拉取一个镜像并打tag")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull hello-world\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag hello-world "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.178:5000/hello-world\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"push到仓库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#push到仓库"}},[s._v("#")]),s._v(" push到仓库")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.178:5000/hello-world\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://192.168.1.178:5000/v2/_catalog\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("push的语法"),n("code",[s._v("sudo docker push <host>/<project>/<repo>:<tag>")]),s._v("，这就是我们刚才打tag的时候为什么要先放host")]),s._v(" "),n("p",[s._v("。打tag的语法为："),n("code",[s._v("docker tag <img_name>:<tag> <host>/<project>/<repo>:<tag>")]),s._v("。")]),s._v(" "),n("p",[s._v("查看发现"),n("code",[s._v('{"repositories":["hello-world"]}')]),s._v("里面已经有刚刚的push了。也可以到"),n("code",[s._v("opt/data/registry/docker/registry/v2/repositories")]),s._v("里面查看有刚刚新加的镜像。")]),s._v(" "),n("h3",{attrs:{id:"pull镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pull镜像"}},[s._v("#")]),s._v(" pull镜像")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.178:5000/hello-world\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("pull的语法："),n("code",[s._v("docker pull <host>/<project>/<repo>:<tag>")]),s._v("。我们可以在局域网里面的其他机器试一下，发现可以正常pull到这个镜像。这样一个简单的私有仓库就搞定了。")]),s._v(" "),n("h3",{attrs:{id:"配置认证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置认证"}},[s._v("#")]),s._v(" 配置认证")]),s._v(" "),n("p",[s._v("直接开放一个5000端口的镜像仓库很显然是很不安全的，至少要有一些基础的身份认证。这边以官方文档给出的例子为例。")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建一个目录hub为基础文件夹")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 新建两个文件夹")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p auth data\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("编辑auth/nginx.conf文件，注意相关ssl证书的位置，这边放到了auth文件夹中。")]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[s._v("events "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    worker_connections  1024;\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nhttp "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n  upstream docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("registry "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    server registry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("5000;\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Set a variable to help us decide if we need to add the")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 'Docker-Distribution-Api-Version' header.")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## The registry always sets this header.")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## In the case of nginx performing auth, the header is unset")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## since nginx is auth-ing before proxying.")]),s._v("\n  map $upstream_http_docker_distribution_api_version $docker_distribution_api_version "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    '' 'registry/2.0';\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen 443 ssl;\n    server_name myregistrydomain.com;\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SSL")]),s._v("\n    ssl_certificate /etc/nginx/conf.d/domain.crt;\n    ssl_certificate_key /etc/nginx/conf.d/domain.key;\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Recommendations from https://raymii.org/s/tutorials/Strong_SSL_Security_On_nginx.html")]),s._v("\n    ssl_protocols TLSv1.1 TLSv1.2;\n    ssl_ciphers 'EECDH+AESGCM"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("EDH+AESGCM"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("AES256+EECDH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("AES256+EDH';\n    ssl_prefer_server_ciphers on;\n    ssl_session_cache shared"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("SSL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("10m;\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# disable any limits to avoid HTTP 413 for large image uploads")]),s._v("\n    client_max_body_size 0;\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# required to avoid HTTP 411: see Issue #1486 (https://github.com/moby/moby/issues/1486)")]),s._v("\n    chunked_transfer_encoding on;\n\n    location /v2/ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Do not allow connections from docker 1.5 and earlier")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# docker pre-1.6.0 did not properly set the user agent on ping, catch "Go *" user agents')]),s._v('\n      if ($http_user_agent ~ "^(docker\\/1\\.(3'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v("4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v("5("),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),n("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!")]),s._v("\\."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dev))"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v("Go )."),n("span",{pre:!0,attrs:{class:"token important"}},[s._v('*$"')]),s._v(" ) "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        return 404;\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# To add basic authentication to v2 use auth_basic setting.")]),s._v('\n      auth_basic "Registry realm";\n      auth_basic_user_file /etc/nginx/conf.d/nginx.htpasswd;\n\n      '),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## If $docker_distribution_api_version is empty, the header is not added.")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## See the map directive above where this variable is defined.")]),s._v("\n      add_header 'Docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Distribution"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Api"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Version' $docker_distribution_api_version always;\n\n      proxy_pass                          http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//docker"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("registry;\n      proxy_set_header  Host              $http_host;   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# required for docker client's sake")]),s._v("\n      proxy_set_header  X"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("IP         $remote_addr; "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pass on real client's IP")]),s._v("\n      proxy_set_header  X"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("For   $proxy_add_x_forwarded_for;\n      proxy_set_header  X"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("Proto $scheme;\n      proxy_read_timeout                  900;\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br")])]),n("p",[s._v("创建访问认证的密码文件auth/nginx.htpasswd，用户名testuser，密码为testpassword")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --rm --entrypoint htpasswd registry:2 -Bbn testuser testpassword "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" auth/nginx.htpasswd\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("编辑docker-compose.yml文件")]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nginx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Note : Only nginx:alpine supports bcrypt.")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# If you don't need to use bcrypt, you can use a different tag.")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Ref. https://github.com/nginxinc/docker-nginx/issues/29")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx:alpine"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 5043"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("links")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" registry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("registry\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/nginx/conf.d\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./auth/nginx.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/nginx/nginx.conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ro\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("registry")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" registry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/lib/registry\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("启动")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up -d\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("操作仓库")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login -u"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("testuser -p"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("testpassword -e"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root@example.ch myregistrydomain.com:5043\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag ubuntu myregistrydomain.com:5043/test\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push myregistrydomain.com:5043/test\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull myregistrydomain.com:5043/test\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"docker-hub"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-hub"}},[s._v("#")]),s._v(" Docker hub")]),s._v(" "),n("p",[s._v("先在"),n("a",{attrs:{href:"https://hub.docker.com",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),n("OutboundLink")],1),s._v("注册一个账号，然后登录"),n("code",[s._v("docker login")]),s._v("，后面的操作就和在私有仓库操作是一样的。")])])}),[],!1,null,null,null);t.default=e.exports}}]);